-- الخدمات المطلوبة
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

-- إعدادات السكريبت
local config = {
    forceDeath = true, -- الموت الفوري عند الإصابة
    infiniteHealth = false, -- تعطيل الصحة اللانهائية
    disableRegen = true, -- تعطيل تجديد الصحة
    damageMultiplier = 1000, -- مضاعفة الضرر
    deathOnAnyDamage = true -- الموت من أي ضرر
}

-- دالة لتطبيق الإعدادات على اللاعب
local function setupPlayer(player)
    local character = player.Character or player.CharacterAdded:Wait()
    
    -- الانتظار حتى يتم تحميل الشخصية بالكامل
    character:WaitForChild("Humanoid")
    
    local humanoid = character:WaitForChild("Humanoid")
    
    -- تعطيل الصحة اللانهائية
    if not config.infiniteHealth then
        humanoid.MaxHealth = 100
        humanoid.Health = 100
    end
    
    -- تعطيل تجديد الصحة
    if config.disableRegen then
        humanoid.HealthChanged:Connect(function()
            if humanoid.Health > 0 and humanoid.Health < humanoid.MaxHealth then
                humanoid.Health = humanoid.Health -- منع التجديد
            end
        end)
    end
    
    -- مراقبة الضرر
    humanoid.Touched:Connect(function(hit)
        -- الكشف عن أي ضرر محتمل
        if hit.Parent then
            local damageValue = hit.Parent:FindFirstChild("Damage")
            if damageValue then
                applyDamage(humanoid, damageValue.Value)
            end
        end
    end)
    
    -- إضافة مستشعر للضرر
    local damageSensor = Instance.new("Part")
    damageSensor.Name = "DamageSensor"
    damageSensor.Size = Vector3.new(5, 5, 5)
    damageSensor.Transparency = 1
    damageSensor.CanCollide = false
    damageSensor.Parent = character
    
    -- اتصال المستشعر
    damageSensor.Touched:Connect(function(hit)
        checkForDamage(humanoid, hit)
    end)
end

-- دالة لتطبيق الضرر
local function applyDamage(humanoid, damageAmount)
    if config.forceDeath then
        -- الموت الفوري
        humanoid.Health = 0
    elseif config.damageMultiplier > 1 then
        -- مضاعفة الضرر
        local actualDamage = damageAmount * config.damageMultiplier
        humanoid.Health = math.max(0, humanoid.Health - actualDamage)
    elseif config.deathOnAnyDamage then
        -- الموت من أي ضرر
        humanoid.Health = 0
    else
        -- الضرر العادي
        humanoid.Health = math.max(0, humanoid.Health - damageAmount)
    end
end

-- دالة للكشف عن أنواع الضرر المختلفة
local function checkForDamage(humanoid, hit)
    local hitParent = hit.Parent
    
    -- الكشف عن الصواريخ والأسلحة
    if hitParent and (hitParent.Name:lower():find("rocket") 
        or hitParent.Name:lower():find("missile")
        or hitParent.Name:lower():find("bullet")
        or hitParent.Name:lower():find("explos")) then
        applyDamage(humanoid, 1000)
    end
    
    -- الكشف عن الحيوانات أو الكائنات المعادية
    if hitParent then
        local humanoidOfHit = hitParent:FindFirstChild("Humanoid")
        if humanoidOfHit then
            -- كشف إذا كان حيوان أو عدو
            if hitParent.Name:lower():find("animal")
                or hitParent.Name:lower():find("wolf")
                or hitParent.Name:lower():find("bear")
                or hitParent.Name:lower():find("enemy") then
                applyDamage(humanoid, 500)
            end
        end
    end
    
    -- الكشف عن السكربتات أو التعويذات
    if hitParent and hitParent:FindFirstChild("Script") then
        local script = hitParent:FindFirstChild("Script")
        if script and script:IsA("Script") then
            applyDamage(humanoid, 9999)
        end
    end
end

-- دالة لحماية اللاعب من السكربتات الأخرى
local function protectFromExternalScripts(player)
    local character = player.Character
    if not character then return end
    
    -- إضافة حماية للـ Humanoid
    local humanoid = character:FindFirstChild("Humanoid")
    if humanoid then
        -- مراقبة التغييرات في الـ Health
        humanoid:GetPropertyChangedSignal("Health"):Connect(function()
            -- منع أي سكربت من تعديل الصحة بشكل غير مصرح به
            if humanoid.Health > 100 then
                humanoid.Health = 100
            end
        end)
        
        -- مراقبة التغييرات في الـ MaxHealth
        humanoid:GetPropertyChangedSignal("MaxHealth"):Connect(function()
            if humanoid.MaxHealth > 100 then
                humanoid.MaxHealth = 100
            end
        end)
    end
    
    -- منع إضافة أي سكربتات خارجية
    character.DescendantAdded:Connect(function(descendant)
        if descendant:IsA("Script") and descendant.Name ~= "LocalScript" then
            descendant.Disabled = true
            descendant:Destroy()
        end
    end)
end

-- تشغيل السكربت
local function initialize()
    -- معالجة اللاعبين الحاليين
    for _, player in ipairs(Players:GetPlayers()) do
        coroutine.wrap(function()
            setupPlayer(player)
            protectFromExternalScripts(player)
        end)()
    end
    
    -- معالجة اللاعبين الجدد
    Players.PlayerAdded:Connect(function(player)
        player.CharacterAdded:Connect(function(character)
            setupPlayer(player)
            protectFromExternalScripts(player)
        end)
    end)
end

-- بدء التشغيل
initialize()

-- تحديث مستمر للحماية
RunService.Heartbeat:Connect(function()
    for _, player in ipairs(Players:GetPlayers()) do
        local character = player.Character
        if character then
            local humanoid = character:FindFirstChild("Humanoid")
            if humanoid then
                -- التأكد من أن الصحة ليست لا نهائية
                if humanoid.Health > 100 then
                    humanoid.Health = 100
                end
                if humanoid.MaxHealth > 100 then
                    humanoid.MaxHealth = 100
                end
            end
        end
    end
end)

print("✅ سكريبت الحماية والموت الفوري مفعل!")
